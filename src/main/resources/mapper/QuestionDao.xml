<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dao.QuestionDao">
    <select id="selectAllTag" resultType="com.bean.Tag">
        SELECT * FROM tag
    </select>
    <select id="selectQuestionsByPage" resultType="com.bean.Question">
        SELECT * FROM question ORDER BY createTime DESC  limit #{currentPage},#{pageSize}
    </select>
    <insert id="insertQuestion" parameterType="com.bean.Question">
        INSERT INTO question (title,content,tagId,imgUrls) VALUES (#{title},#{content},#{tagId},#{imgUrls})
    </insert>

    <select id="selectQuestionCount" resultType="int">
       select count(*) from question
    </select>
    <!--根据问题Id获取问题详情-->
    <select id="selectQuestionById" resultType="com.bean.Question">
       select * from question WHERE questionId=#{questionId}
    </select>

    <!--根据问题Id获取提问者信息-->
    <select id="selectAccountByQuestionId" resultType="com.bean.Account">
      SELECT account.account_Id, account.name, account.avatar
      FROM question INNER JOIN account
      ON account.account_id=question.accountId
      WHERE question.questionId=#{questionId}
    </select>
    <!--根据问题Id获取回答-->
<select id="selectAnsewerByQuestionId" resultMap="AnswerResult">
    SELECT question.questionId,account.account_id,account.name,account.avatar,answer.answerId,answer.content,answer.createTime,answer.praiseCount,answer.collectCount
FROM answer
LEFT JOIN question
ON answer.questionId=question.questionId
LEFT JOIN account
ON answer.accountId=account.account_id WHERE question.questionId=#{questionId}
</select>
    <resultMap type="com.bean.AnswerResult" id="AnswerResult">
        <result property="questionId" column="questionId" />
        <result property="accountId" column="account_id" />
        <result property="name" column="name" />
        <result property="avatar" column="avatar" />
        <result property="answerId" column="answerId" />
        <result property="content" column="content" />
        <result property="createTime" column="createTime" />
        <result property="praiseCount" column="praiseCount" />
        <result property="collectCount" column="collectCount" />
    </resultMap>
</mapper>